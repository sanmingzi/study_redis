# Hyper Log Log

使用场景：统计访问某个页面的用户数量，同一个用户多次访问只算一次。

## 概率统计原理

抛硬币

连续抛 1 次硬币，全部正面的概率是：1/2；大概需要尝试 2 次可以得到。
连续抛 2 次硬币，全部正面的概率是：1/4；大概需要尝试 4 次可以得到。
连续抛 3 次硬币，全部正面的概率是：1/8；大概需要尝试 8 次可以得到。

小明在抛 3 枚硬币，有一次 3 枚硬币都是正面朝上，请问小明一共抛了多少次？概率上来说应该是 8 次。

将抛硬币问题进行延伸。我们现在做随机数游戏，每次生成一个随机数。

```
xxx1 -> 大概需要随机 1 次
xxx10 -> 大概需要随机 2 次
xxx100 -> 大概需要随机 4 次
```

我们将需要统计的内容二进制话，就可以通过该方法来进行 uniq count。

## 简单实现

[hyper_log_log.rb](./hyper_log_log.rb)

1. 根据二进制的低 10 位，来确定将该二进制放入哪个桶中
2. 除去二进制的低 10 位，来计算得到该二进制数最可能需要的次数
3. 如果该次数比桶中原有的次数大，则更新桶中记录的次数
4. 根据所有记录次数桶的调和平均 https://zh.wikipedia.org/zh-sg/%E8%B0%83%E5%92%8C%E5%B9%B3%E5%9D%87%E6%95%B0
5. 通过调和平均计算总的次数
6. 误差修正，设置修正系数位 0.7，还有更加精确的修正方法。
